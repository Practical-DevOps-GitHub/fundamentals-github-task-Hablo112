name: Discord notification on PR created

on:
  pull_request:
    types: [opened]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord message
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          PR_TITLE: ${{ github.event.pull_request.title }}
          PR_URL: ${{ github.event.pull_request.html_url }}
          PR_AUTHOR: ${{ github.event.pull_request.user.login }}
          PR_BASE: ${{ github.event.pull_request.base.ref }}
          PR_HEAD: ${{ github.event.pull_request.head.ref }}
          REPO: ${{ github.repository }}
        run: |
          payload=$(cat << 'JSON'
          {
            "username": "GitHub PR Bot",
            "content": "ðŸš€ **New Pull Request created!**\n\nðŸ“¦ **Repo:** ${REPO}\nðŸ”€ **From:** ${PR_HEAD} â†’ **To:** ${PR_BASE}\nðŸ“ **Title:** ${PR_TITLE}\nðŸ‘¤ **Author:** ${PR_AUTHOR}\nðŸ”— **Link:** ${PR_URL}"
          }
          JSON
          )
          # Ð¿Ñ–Ð´ÑÑ‚Ð°Ð²Ð¸Ð¼Ð¾ env Ð·Ð¼Ñ–Ð½Ð½Ñ– (Ð¿Ñ€Ð¾ÑÑ‚Ð¸Ð¹ Ñ– Ð½Ð°Ð´Ñ–Ð¹Ð½Ð¸Ð¹ ÑÐ¿Ð¾ÑÑ–Ð±)
          payload=$(echo "$payload" | sed "s|\${REPO}|$REPO|g; s|\${PR_HEAD}|$PR_HEAD|g; s|\${PR_BASE}|$PR_BASE|g; s|\${PR_TITLE}|$PR_TITLE|g; s|\${PR_AUTHOR}|$PR_AUTHOR|g; s|\${PR_URL}|$PR_URL|g")
          curl -sS -H "Content-Type: application/json" -X POST -d "$payload" "$DISCORD_WEBHOOK_URL"
